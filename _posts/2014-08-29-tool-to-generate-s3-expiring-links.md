---
layout: post
title: "Tool to Generate S3 Expiring Links"
description: ""
category: 
tags: []
comments: false
---
{% include JB/setup %}

### [s3-expiry.50projects.com](http://s3-expiry.50projects.com/)

## The Problem

While doing some AWS consulting for a new client I was struck by how difficult it was sometimes to download a file from [S3](http://aws.amazon.com/s3/).
You can make the file world readable, but that's not terribly secure and odds are you'll forget to turn it off.
You can copy the URL generated by the Download button in the [S3](http://aws.amazon.com/s3/) console, but by default that only lasts 5 minutes, and if you have a 5Gb file you'll be out of luck.
A plethora of tools exist to solve this problem but I never have time to install, configure, purchase a license, etc...

Fortunately [S3](http://aws.amazon.com/s3/) allows you to [generate your own](http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-query-string-auth.html) expiring links with expirations lasting up to 7 days.
With that in mind all I needed to do was build a simple client-side JS app that would generate the link for me.
Then I could put it online and use it whenever necessary without fear of exposing my clients sensitive data.

## Building It

[CryptoJS](https://code.google.com/p/crypto-js/) exists and allows me to perform the necessary HMAC-SHA256 operations to generate the signature.
The tough part was implementing it in JS and matching Amazon's very [finnicky documentation](http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-query-string-auth.html).

## Lessons Learned

* I could have built this for Signature Version 2 which is far simpler.
* The [AWS documentation's]((http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-query-string-auth.html) [HMAC-SHA256](http://en.wikipedia.org/wiki/Hash-based_message_authentication_code) function takes the secret first. CryptoJS takes the secret as the last argument.
* I still have trouble making things look pretty. I need a CSS framework for quick utility sites that doesn't require me to relearn everything.
* I adore that you can host a site quickly on s3. Simply create a bucket named the domain you'll be hosting, then set everything to public.
* [S3](http://aws.amazon.com/s3/) is still slow for publicly hosting resources. If this were higher traffic I'd put a [CloudFront](http://aws.amazon.com/cloudfront/) instance in front of it.
* I was a bit bummed to see someone beat me to building this. You can see their implementation at http://www.dancartoon.com/projects/s3-siggenerator/

## Code And Link

### [github.com/pcorliss/s3-expiry](https://github.com/pcorliss/s3-expiry)
### [s3-expiry.50projects.com](http://s3-expiry.50projects.com/)

